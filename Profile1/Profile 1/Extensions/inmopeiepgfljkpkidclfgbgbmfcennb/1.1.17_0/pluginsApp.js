"use strict";(()=>{var l="@RESPONSIVE-VIEWER";var i="https://responsiveviewer.org",R=`${i}/user/extension`,w=`${i}/user/session`,h=`${i}/user/uploads`,u=`${i}/api/feedback`,m=`${i}/uninstall`,x=`${i}/api/install`;var f=`${i}/login`,v=`${i}/dashboard`,A=`${i}/plugins`;var o=(s="",t="")=>{let e=`${l}${t?"-"+t:""}`;return s.startsWith(e)?s:`${e}/${s}`};var g=(s,t=window.screenId,e)=>{let n=r=>{!r.data||!String(r.data.message).startsWith(o("",e))||r.data.screenId!==t&&s(r.data)};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}};var d=(s,t={},e,n="")=>{window.top&&window.top.postMessage({...t,message:o(s,n),screenId:e||window.screenId},"*")};var p="__@RESONSIVE_VIEWER_DONT_USE@__";function c(s,t){let e=new MutationObserver(()=>{s.parentElement||(t(),e.disconnect(),c(s,t))});e.observe(s.parentElement,{childList:!0})}var _=()=>Math.random().toString(36).slice(2);var I,a=class{constructor(){this.commands=new Map}boot(){if(this.canvas)return;(()=>{let e=document.createElement("canvas");e.setAttribute("response-viewer-attr","true"),e.width=window.innerWidth*window.devicePixelRatio,e.height=window.innerHeight*window.devicePixelRatio,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.direction="ltr",e.style.zIndex="999999",e.style.pointerEvents="none",document.body.appendChild(e),c(e,()=>{document.body.appendChild(e),this.render()}),this.canvas=e,e.getContext("2d")?.scale(window.devicePixelRatio,window.devicePixelRatio),window.addEventListener("resize",()=>{window.clearTimeout(I),e.width=window.innerWidth*window.devicePixelRatio,e.height=window.innerHeight*window.devicePixelRatio,e.getContext("2d")?.scale(window.devicePixelRatio,window.devicePixelRatio),I=window.setTimeout(()=>{this.render()},50)}),window.addEventListener("scroll",()=>{this.render()})})()}addDraw(t,e){e=e||_(),this.commands.set(e,t)}removeDraw(t,e){typeof t=="string"?this.commands.delete(t):this.commands.forEach((n,r)=>{n===t&&this.commands.delete(r)}),e&&this.render()}render(){if(this.boot(),!this.canvas)return;let t=this.canvas?.getContext("2d");if(t){t.clearRect(0,0,this.canvas.width,this.canvas.height);for(let[e,n]of this.commands)n(t)}}};var E=class{constructor(){this.#e=new Map;this.screenId="";this.#t=!1;this.#n={};this.canvas=new a}#e;#t;#n;onReady(t){document.body?t():window.addEventListener("DOMContentLoaded",()=>{t()})}memory(t,e){return e===void 0?this.#n[t]:(this.#n[t]=e,e)}start(t){if(this.#t){console.warn("[Plugin Manager]: already started");return}this.#t=!0,this.screenId=t,g(({message:e,...n})=>{this.runListeners(e,n)},this.screenId)}runListeners(t,e={}){let n=this.#e.get(t);n&&n.forEach(r=>r(e))}inform(t,e){d(t,e,this.screenId,"INFORM")}broadcast(t,e={}){d(t,e,this.screenId)}addMessage(t,e){return this.#e.has(t)||this.#e.set(t,[]),this.#e.get(t)?.push(e),()=>this.#e.get(t)?.filter(n=>n!==e)}listen(t,e){return this.addMessage(o(t),e)}onPluginLoaded(t,e){this.listen("PLUGINS_LOADED",n=>{for(let r of n.plugins)r.name===t&&e(r)})}onPluginActivate(t,e){return this.listen("PLUGIN/ACTIVATE",n=>{n.plugin===t&&e()})}onPluginDeActivate(t,e){return this.listen("PLUGIN/DEACTIVATE",n=>{n.plugin===t&&e()})}};window[p]=new E;})();
